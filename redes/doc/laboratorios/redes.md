# Redes

Vamos iniciar nosso projeto inserindo dois computadores no setor de finanças e outros dois computadores no setor de vendas. Na sequência insira dois Switches (modelo 2950-24), um que ficará na sala de finanças e outro que ficará na sala de vendas e por fim realize a conexão dos Switches com os computadores, usando um cabo direto e a conexão entre os Switches usando um cabo crossover.

Devemos agora configurar cada Switch para atuar em sua respectiva Vlan (iremos adotar a Vlan 10 para o setor de vendas e a Vlan 20 para o setor de finanças). Para isso siga os seguintes passos:

Clique no Switch da esquerda, conectado ao setor de vendas e em seguida clique na aba CLI Entre no modo privilegiado digitando enable Entre na parte de configuração do Switch digitando configure terminal Devemos criar a Vlan 10, para isso digite vlan 10 e na sequência digite name VENDAS Uma vez que a Vlan 10 foi criada, devemos sair da configuração da vlan digitando o comando exit Em seguida, entre na interface usada para conectar o Switch com o computador do Gerente de Vendas (por exemplo: interface FastEthernet 0/1) Devemos informar que essa porta do Switch está conectada com um dispositivo final, digitamos: switchport mode access Na sequência, devemos associar essa interface com a Vlan 10, para isso digite: switchport access vlan 10 Devemos sair dessa interface para depois entrar na interface que está conectada ao computador do funcionário de vendas. Digite o comando: exit Entre na interface conectada ao computador do funcionário de vendas (por exemplo: interface FastEthernet 0/2) Devemos informar que essa interface está conectada a um dispositivo final, digite: switchport mode access Em seguida, devemos associar essa interface com a Vlan 10, digite: switchport access vlan 10 Verifique se tais interfaces foram associadas a Vlan 10. Para isso digite CTRL+Z para voltar a parte privilegiada e na sequência digite o comando show vlan brief Clique no computador do gerente de vendas -> Aba Desktop -> IP Configuration Insira o IP 192.168.0.1 Em seguinda clique no computador do funcionário de vendas -> Aba Desktop -> IP Configuration Insira o IP 192.168.0.2 Abra o terminal no computador do gerente de vendas e tente realizar o ping para o computador do funcionário de vendas. Qual o resultado?

Devemos agora separar o setor de finanças dentro de sua própria Vlan. Vamos realizar os seguintes passos:

Clique no Switch conectado aos computadores do setor de finanças e vá até a aba CLI Entre na parte privilegiada, digitando enable Na sequência, entre na parte de configuração do Switch digitando o comando: configure terminal Devemos criar essa VLAN no Switch, para isso digite: vlan 20 Em seguida, devemos dar o nome para essa VLAN. Digitamos name FINANCAS Devemos sair da configuração da VLAN 20, digite: exit Uma vez que a VLAN foi configurada e o seu nome foi dado, devemos entrar na interface conectada ao computador do gerente de finanças (por exemplo: interface FastEthernet 0/1) Devemos informar que essa interface do Switch está conectada a um dispositivo final, dessa forma, digitamos: switchport mode access Em seguida, devemos associar essa interface para que atue na VLAN 20 que acabamos de criar, digitamos: switchport access vlan 20 Vamos sair dessa interface do computador do gerente de finanças, digitando o comando exit Entre na interface conectada ao computador do funcionário de finanças (por exemplo: interface FastEthernet 0/2) Devemos informar que essa interface está conectada a um dispositivo final digitando: switchport mode access Em seguida, devemos associar essa interface junto a VLAN 20, digitamos switchport access vlan 20 Verifique se as duas interfaces foram associadas com essa VLAN. Digite CTRL + Z para voltar a parte privilegiada e na sequência digite show vlan brief Em seguida clique no computador do gerente de finanças -> Aba Desktop -> IP Configuration e insira o IP 192.168.0.3 Por fim clique no computador do funcionário de finanças -> Aba Desktop -> IP Configuration e insira o IP 192.168.0.4 Tente realizar o ping entre o computador do gerente de finanças e o computador do funcionário de finanças. Qual o resultado?

Na semana seguinte, os diretores da empresa informaram que o gerente de vendas e o gerente de finanças irão trocar de sala, pois assim poderão aprender como a outra área trabalha e sugerir melhorias. Vamos realizar essa etapa:

Devemos desconectar os cabos do gerente de vendas e do gerente de finanças dos seus respectivos Switches.

Na sequência, altere as posições dos computadores e faça a conexão do computador do gerente de finanças em qualquer porta do Switch do setor de vendas e o computador do gerente de vendas em qualquer porta do Switch do setor de finanças, para manter uma uniformidade, vamos conectar na porta FastEthernet 0/4. Devemos ter um resultado final parecido com o abaixo:

Uma vez que alteramos a posição dos gerentes, devemos alocar suas respectivas Vlans nos novos Switches. Dessa forma, clique no Switch da esquerda que seria do setor de vendas e vá até a aba CLI Digite o comando enable para entrar no modo privilegiado Entre na parte de configuração, digitando: configure terminal Devemos criar a Vlan 20, que seria usada para alocar os usuários do setor de finanças. Digitamos vlan 20 e na sequência colocamos name FINANCAS Em seguida, saímos da configuração da Vlan digitando: exit Devemos agora entrar na interface conectado ao computador do gerente de finanças (por exemplo: interface FastEthernet 0/4). O primeiro passo para associar uma interface com uma Vlan é informar que tal interface está conectada a um dispositivo final, digitamos: switchport mode access e em seguida digitamos switchport access vlan 20 Digite CTRL+Z para voltar a parte privilegiada e digite o comando show vlan brief. Confirme se a interface conectada ao computador do gerente de finanças está na Vlan 20 e que a interface do funcionário de vendas continua na Vlan 10. Clique agora no Switch do lado direito, que está conectado ao setor de finanças e vá até a aba CLI. Digite o comando enable para entrar no modo privilegiado Entre na parte de configuração, digitando: configure terminal Devemos criar a Vlan 10, que seria usada para alocar os usuários do setor de vendas, digitamos: vlan 10 e em seguida digitamos name VENDAS Em seguida devemos associar a essa Vlan 10 a interface que usamos para conectar com o computador do gerente de vendas. Digitamos exit para voltar a aba global de configuração. Na sequência, temos que entrar nessa interface conectada ao computador do gerente de vendas (por exemplo: interface FastEthernet 0/4) Para associar a Vlan 10, devemos inicialmente informar que essa interface está conectada a um dispositivo final: switchport mode access e na sequência realizamos a associação switchport access vlan 10 Em seguida, verifique se a interface conectada ao computador do gerente de vendas está na Vlan 10 e se a interface conectada ao computador do funcionário de finanças continua na 20, digitando CTRL+Z para voltar a parte privilegiada e na sequência digite show vlan brief Agora cada usuário está vinculado com a Vlan de seu respectivo setor. Tente realizar o PING entre os usuários da mesma Vlan, por exemplo, abra o computador do gerente de vendas, vá até o command prompt e tente "pingar" o computador do funcionário de vendas, por exemplo: ping \[endereço IP funcionário de vendas]. Qual o resultado?

Os usuários que estão na mesma VLAN não conseguem se comunicar visto que as interfaces interconectando os Switches estão configuradas somente para transportar a VLAN nativa. Dessa forma, precisamos configurar essas portas dos Switches para transportarem múltiplas VLANs, configuração conhecida como modo Trunk.

Clique no Switch do lado esquerdo e vá até a aba CLI Entre na parte privilegiada digitando o comando enable Em seguida, entre na parte de configuração digitando configure terminal Posteriormente, entre na interface que está conectada com o outro Switch (por exemplo: interface FastEthernet 0/3) Devemos alterar essa porta para atuar em modo trunk, digite switchport mode trunk Verifique se essa interface foi configurada como interface trunk digitando o comando CTRL+Z e em seguida show interfaces trunk. Veja que a interface que configuramos está atuando em modo trunk e que agora além da Vlan nativa, temos que a Vlan 10 e a Vlan 20 também são permitidas Clique agora no Switch do lado direito e vá até a aba CLI Entre no modo privilegiado digitando enable e na sequência entre na parte de configuração digitando configure terminal Entre na interface conectada ao primeiro Switch (por exemplo: interface FastEthernet 0/3) Agora devemos alterar a porta para atuar no modo trunk, digitamos: switchport mode trunk Vamos confirmar que a configuração foi realizada corretamente, digitamos: CTRL+Z e na sequência digitamos show interfaces trunk Veja que a interface conectada com o primeiro Switch está configurada para trabalhar em modo trunk e agora pode realizar o transporte das VLANs 1, 10 e 20 Tente agora realizar o mesmo ping do exercício anterior, do gerente de vendas para o funcionário de vendas. Qual o resultado?

Nós conseguimos realizar um bom avanço, mas não conseguimos ainda estabelecer a comunicação entre dispositivos de Vlans diferentes. Para isso, precisamos realizar um roteamento entre as Vlans, hoje em dia existem Switches que são capazes de realizar tal roteamento e são chamados de Switches Layer 3. No projeto da empresa da Mutillidae, nós iremos usar um roteador.

Arraste para área de trabalho o roteador modelo 1841 e conecte esse roteador com o Switch do lado esquerdo, nosso projeto deverá ficar parecido com a imagem abaixo:

Clique no roteador e vá até a aba CLI Caso apareça uma mensagem perguntando se queremos habilitar uma caixa de diálogos, digitamos no Posteriormente devemos entrar na parte privilegiada, digitamos enable e em seguida digitamos configure terminal para entrar na parte de configuração Entre na interface do roteador que foi conectada com Switch (por exemplo: interface FastEthernet 0/0) As portas dos roteadores empresariais da Cisco vem desabilitadas por padrão, devemos habilitá-las, então digitamos: no shutdown Lembre-se que teremos 100 usuários no setor de finanças e 300 usuários no setor de vendas, então vamos configurar para esses usuários receberem esses endereços IP automaticamente através do servidor DHCP. Como a Vlan divide nossa rede interna em redes menores que estarão isoladas entre si, devemos usar endereços IPs que estão em redes diferentes. Vamos configurar os endereços IP da rede 192.168.10.0 para a Vlan 10 de vendas e os endereços IP da rede 192.168.20.0 para a Vlan 20 de finanças.

Digitamos exit para sair da configuração da interface e voltar para configuração global. Em seguida criamos o pool de endereços IP para os usuários de vendas, digitamos: ip dhcp pool \[nome do pool], por exemplo ip dhcp pool VLAN10 Devemos informar qual é o endereço IP de rede que queremos associar a esse pool, como a Vlan 10 é de vendas, digitamos: network 192.168.10.0 255.255.255.0 Vamos configurar o endereço IP de gateway para serem entregues para os dispositivos, o endereço IP de gateway deverá ser um endereço IP válido (não podemos atribuir para o endereço IP de gateway o endereço IP de rede 192.168.10.0 nem o endereço IP de broadcast 192.168.10.255). Vamos atribuir o primeiro endereço IP disponível, 192.168.10.1. Digitamos o comando default-router 192.168.10.1 Vamos sair da configuração desse pool da VLAN10 digitando exit e em seguida vamos criar o pool de endereços para a vlan 20. Digitamos ip dhcp pool VLAN20 Em seguida, temos que associar o endereço IP de rede que deverá ser associada para essa Vlan 20, digitamos: network 192.168.20.0 255.255.255.0. Em seguida, vamos atribuir um endereço IP como sendo o gateway para ser entregue aos demais usuários, digitamos: default-router 192.168.20.1

Através dos pools que criamos, teremos os endereços IP alocados automaticamente para os usuários de vendas e finanças. Vamos realizar essa configuração na próxima etapa.

As configurações dos pools DHCP foram feitas com sucesso. Mas só temos uma interface e devemos atribuir automaticamente endereços IP para a Vlan 10 e para a Vlan 20. Dessa forma, temos que dividir essa interface principal que usamos para conectar ao switch em sub-interfaces, sendo que uma sub-interface será responsável por atribuir endereços IP para a Vlan 10 de vendas e outra sub-interface será responsável por atribuir endereços IP para a Vlan 20 de finanças.

Devemos sair da configuração do pool dhcp e voltar para configuração global, digitando: exit. Na sequência, devemos criar essas sub-interfaces, vamos iniciar com a sub-interface de vendas, digitamos por exemplo interface FastEthernet 0/0.1 Uma vez que a sub-interface foi criada vamos atribuí-la a Vlan 10, para isso digitamos: encapsulation dot1Q 10. Uma vez que a atribuição foi feita devemos associar o endereço IP do default-router da Vlan 10 para a sub-interface, digitamos: ip address 192.168.10.1 255.255.255.0 Precisamos agora configurar uma segunda sub-interface para o setor de finanças, digitamos por exemplo: interface FastEthernet 0/0.2 Nessa segunda sub-interface atribuímos que ela irá atuar com a vlan 20 de finanças, digitamos encapsulation dot1Q 20. Em seguida atribuímos o endereço IP do default-router para essa sub-interface, digitamos: ip address 192.168.20.1 255.255.255.0. Configuramos duas sub-interfaces e cada uma irá atuar para uma Vlan, vamos nos computadores dos usuários e atribuir os endereços IP via DHCP.

Clique no computador -> Aba Desktop -> IP Configuration -> DHCP Houve problema na atribuição dos endereços via DHCP? Porque ocorre um erro na atribuição dos endereços IP?

Esse erro ocorre uma vez que interface do Switch que foi utilizada para conexão com o Roteador não foi configurada para transportar dados da Vlan 10 e da Vlan 20, ela trafega somente dados da Vlan 1, que seria a Vlan nativa. Dessa forma, temos que configurar a interface do Switch conectada ao roteador para que ela atue em modo trunk, podendo assim transmitir dados da Vlan 10 e da Vlan 20.

A atribuição automática de endereços IP via DHCP ainda não foi executada com sucesso. Isso ocorre porque a interface do Switch conectada com o roteador está configurada para trafegar dados somente da Vlan 1, temos que configurá-la em modo trunk para que possa assim transmitir dados da Vlan 10 de vendas e da Vlan 20 de finanças.

Clique no Switch que possui a interface conectada ao roteador e vá até a aba CLI. Entre na parte privilegiada digitando enable Em seguida entre na parte de configuração digitando: configure terminal Entre na interface que está conectada ao roteador, por exemplo: interface FastEthernet 0/5 Em seguida, altere essa porta para atuar em modo trunk, digitamos: switchport mode trunk Verifique se os endereços IP são atribuídos via DHCP. Tente realizar o ping do computador do gerente de vendas e do gerente de finanças que estão em Vlan diferentes, indo até o computador do gerente de vendas -> Aba Desktop -> Command Prompt e digitando ping \[endereço IP gerente de vendas]. Qual o resultado?

Uma vez que configuramos a porta do Switch para atuar em modo trunk, os dados da Vlan 10 e da Vlan 20 são passados e portanto o aquisição de endereços IP DHCP foi estabelecida com sucesso. Ao realizar o ping entre o computador do gerente de vendas e o gerente de finanças teremos o roteador que se encarregará de realizar esse roteamento entre eles e dessa forma, a comunicação é estabelecida com sucesso.

Vamos criar uma redundância em nossos links inserindo um terceiro Switch. Uma interface desse terceiro Switch será conectada ao roteador e outras duas interfaces serão conectadas a interfaces dos outros dois Switches já implementados. Nosso projeto deverá ficar parecido com a imagem abaixo:

Esse novo Switch deverá transportar dados da Vlan 10 e da Vlan 20, o primeiro passo será criar essas Vlans no novo Switch, uma vez que elas não possuem tais Vlans configuradas.

Clicamos nesse novo Switch e selecionamos a aba CLI Entramos no modo privilegiado, digitando: enable e posteriormente entramos na parte de configurações digitando: configure terminal Criamos a vlan de vendas, digitando: vlan 10 e em seguida digitamos: name VENDAS. Em seguida, vamos criar a vlan de finanças, digitamos vlan 20 e em seguida digitamos name FINANCAS Na sequência, devemos selecionar as interfaces para realizar a mudança do modo de operação para que possa encaminhar essas Vlans. Vamos entrar primeiramente na interface conectada com o Switch de vendas (o que está no canto inferior esquerdo). Digitamos por exemplo: interface FastEthernet 0/5 Uma vez que estamos na parte de configuração da interface, alteramos o modo de operação para trunk, digitando: switchport mode trunk Com essa interface configurada, devemos configurar as outras duas. Para isso digite exit para sair da configuração da primeira interface e digite o comando para entrar na interface usada para conectar com o Switch do setor de finanças (lado inferior direito), por exemplo: interface FastEthernet 0/6 Em seguida devemos configurar essa porta para atuar no modo trunk, digitamos switchport mode trunk Por fim, devemos configurar a interface desse novo Switch conectado ao roteador para também atuar em modo trunk. Saímos da configuração da outra interface digitando exit e entramos nessa interface conectada com o roteador, digitando por exemplo: Interface FastEthernet 0/1 Devemos alterar essa interface para atuar em modo trunk, digitamos: switchport mode trunk Tente realizar o ping entre o gerente de vendas e o funcionário de vendas. Para isso, clique no computador do gerente de vendas e vá até a aba Command Prompt e digite ping \[endereço IP do funcionário de vendas]. Qual é o resultado?

Uma vez que configuramos a Vlan 10 de vendas e a Vlan 20 de finanças no novo Switch e alteramos o modo de operação de suas portas conectadas aos outros Switches e ao roteador para modo trunk, tudo deverá estar funcionando como antes, mas agora temos uma redundância e caso algum desses links caia, teremos um outro de backup que irá assumir.

Através do terceiro Switch conseguimos criar uma redundância em nosso projeto. Vamos testar se essa redundância realmente está atuando como deveria.

Clique no computador do gerente de vendas e abra o Command Prompt, faça o ping com o computador para o funcionário de vendas, digitando ping \[endereço IP funcionário de vendas]. Perceba que o ping está funcionando normalmente. Clique no botão

que está no canto direito e posteriormente clique em um dos cabos ativos para removê-lo. Teremos uma imagem parecida com a abaixo:

Tente realizar o ping, qual é o resultado?

Obs: No final, insira novamente o cabo que foi previamente interrompido

Quando removemos um dos links ativos, ocorrerá uma breve interrupção. Assim que esse link ficar indisponível, o protocolo do STP irá informar para a porta que estava bloqueada que ela deverá assumir uma vez que o link principal se tornou indisponível e a comunicação continua sendo estabelecida com sucesso.

Devemos agora configurar esse último Switch para ser o principal de nossa rede, o Switch Root. Antes, conecte novamente o cabo removido na etapa anterior.

Clique no Switch conectando o roteador e vá até a aba CLI Entre no modo privilegiado digitando o comando enable Verifique se esse Switch é o Root para Vlan 10, digitando o comando show spanning-tree vlan 10 Caso não tenhamos nenhuma mensagem no campo Root ID dizendo: This bridge is the root significa que um dos outros dois Switches previamente configurados é que foram eleitos como sendo o Switch Root.

Verifique agora se esse Switch é o Root para Vlan 20, digitando o comando: show spanning vlan 20 Entre na parte de configuração digitando: configure terminal Em seguida, devemos colocar esse Switch com a prioridade mais baixa (0) para que ele se transforme no Root tanto para a Vlan 10 como para a Vlan 20. Digitamos: spanning-tree vlan 10 priority 0 e na sequência digitamos: spanning-tree vlan 20 priority 0 Volte para a parte privilegiada e verifique se esse Switch se tornou o Root para a Vlan 10 e para a Vlan 20 através do comando show spanning-tree vlan 10 e show spanning-tree vlan 20, respectivamente. Qual o resultado?

Uma vez que alteramos a prioridade do Switch para 0, um valor abaixo do padrão 32.768, esse Switch se tornou o Root tanto para a Vlan 10 como para a Vlan 20

Começando por aqui? Segue download do arquivo da aula anterior: https://drive.google.com/file/d/0BzmYQVmw4W7neE1LdU9oY3pFeFk/view?usp=sharing\&resourcekey=0-F7l2mcEGPnYzs4hkoC4mFA

Tivemos um problema em nosso projeto, estamos usando os endereços IP 192.168.x.x e máscara de rede padrão da classe C 255.255.255.0. Com essa configuração, nós conseguimos obter somente 254 endereços disponíveis.

Ao alterar a análise para o endereço IP 172.16.x.x e máscara de rede padrão da classe B 255.255.0.0 teremos mais de 60.000 endereços IP disponíveis. Dessa forma, não estávamos atendendo o pedido dos diretores que seria trabalhar com os endereços IP da forma mais eficiente possível. Precisamos alterar a máscara de rede a fim de garantir maior eficiência para alocação de 300 usuários (300 hosts) e depois para os 100 usuários de finanças (100 hosts). Para os 300 usuários, temos que a máscara 255.255.254.0 apresenta uma melhor eficiência e para os 100 usuários de finanças temos que a máscara 255.255.255.128 apresenta uma melhor eficiência.

Dessa forma, estamos pegando a rede que iria de 172.16.0.0 - 172.16.255.255 e estamos "quebrando" em várias sub-redes. Tais sub-redes estarão totalmente isoladas umas das outras, iremos alocar essas sub-redes para os dois setores.

Clique no roteador e vá até a aba CLI Entre na parte privilegiada digitando enable Entre na parte de configuração, digitando: configure terminal Devemos alterar o pool DHCP para que forneçam esses endereços IP respectivos a sub-redes, alteramos primeiro o pool DHCP do setor de vendas uma vez que temos mais usuários para serem alocados. Digitamos ip dhcp pool VLAN10 Devemos agora informar a sub-rede que estamos trabalhando junto com a máscara de rede. Digitamos: network 172.16.0.0 255.255.254.0 Não podemos nos esquecer que agora que alteramos a sub-rede que estamos trabalhando, temos que ajustar o default-router e os endereços IP das sub-interfaces. Alteramos primeiramente o gateway que será atribuído para os computadores, digitamos: default-router 172.16.0.1 Na sequência, precisamos alterar a pool DHCP referente ao setor de finanças. A primeira sub-rede foi alocada para o setor de vendas, temos que atribuir outra sub-rede para o setor de finanças, escolhemos por exemplo, a segunda sub-rede disponível (172.16.2.0). Digitamos exit para sair da configuração do pool DHCP referente ao setor de vendas e na sequência digitamos por exemplo ip dhcp pool VLAN20 para entrar no pool DHCP do setor de finanças Essa segunda sub-rede pode atribuir até 510 endereços IP, vamos tentar "quebrar" essa sub-rede em novas sub-redes para poder ter assim uma melhor eficiência para alocação de 100 usuários. Definimos a segunda sub-rede que será alocada para o setor de finanças (172.16.2.128), digitamos: network 172.16.2.128 255.255.255.128. Pois com essa máscara, conseguiremos uma melhor eficiência para alocação de endereços IP para 100 usuários. Devemos alterar agora o gateway que será alocado para os usuários, digitamos: default-router 172.16.2.129 Teremos agora que alterar os endereços IP das sub-interfaces para seus respectivos endereços IP que definimos como default-router. Saímos da parte de configuração do pool DHCP digitando exit e posteriormente entramos na primeira sub-interface que criamos respectivo a Vlan 10 de vendas (por exemplo: interface FastEthernet 0/0.1) Devemos agora alterar o endereço IP dessa sub-interface para o default-router que configuramos para os setor de vendas (172.16.0.1). Digitamos ip address 172.16.0.1 255.255.254.0. Em seguida, saímos da configuração dessa sub-interface digitando exit Por fim, devemos alterar o endereço IP da sub-interface do setor de finanças para o default-router que configuramos (172.16.2.129). Entramos na sub-interface que configuramos para o setor de vendas (por exemplo: interface FastEthernet 0/0.2), na sequência digitamos ip address 172.16.2.129 255.255.255.128 Faça uma nova requisição DHCP e posteriomente teste a conectividade com os dispositivos da mesma Vlan e dos dispositivos que estão em outra Vlan. Qual é o resultado?

Uma vez que alteramos os pools DHCP do setor de vendas e finanças para atuar com novos endereços IP, teremos esses endereços alocados automaticamente para os usuários de cada setor. Além disso, deixamos de usar uma única rede que era capaz de alocar mais de 60.000 endereços IP (classe B) e criamos várias sub-redes que forneciam endereços IP de uma forma mais eficiente para a quantidade de usuários que possuíamos.

A comunicação continua sendo estabelecido com sucesso!

Setor finanças
